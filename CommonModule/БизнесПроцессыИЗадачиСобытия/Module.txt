// Обработчик подписки на событие ЗаписатьВСписокБизнесПроцессов.
//
Процедура ЗаписатьВСписокБизнесПроцессов(Источник, Отказ) Экспорт
	
	Если Источник.ОбменДанными.Загрузка Тогда 
        Возврат;  
	КонецЕсли; 
	
	СписокПолей = "Номер,Дата,Завершен,Стартован,Автор,ДатаЗавершения,Наименование,ПометкаУдаления";
	ЗначенияПолей = Новый Структура(СписокПолей);
	ЗаполнитьЗначенияСвойств(ЗначенияПолей, Источник, СписокПолей);
	БизнесПроцессыИЗадачиВызовСервера.ЗаписатьВСписокБизнесПроцессов(Источник.Ссылка,
		ЗначенияПолей);

КонецПроцедуры

// Обработчик подписки на событие УстановитьПометкуУдаленияЗадач.
//
Процедура УстановитьПометкуУдаленияЗадач(Источник, Отказ) Экспорт
	
	Если Источник.ОбменДанными.Загрузка Тогда 
        Возврат;  
	КонецЕсли; 
	
	БизнесПроцессыИЗадачиВызовСервера.УстановитьПометкуУдаленияЗадач(Источник.Ссылка, Источник.ПометкаУдаления);
	
КонецПроцедуры

// Обработчик подписки на событие ПередЗаписьюБизнесПроцесса.
//
Процедура ОбновитьСостояниеБизнесПроцесса(Источник, Отказ) Экспорт
	
	Если Источник.ОбменДанными.Загрузка Тогда 
        Возврат;  
	КонецЕсли; 
	
	Если Источник.Метаданные().Реквизиты.Найти("Состояние") = Неопределено Тогда
		Возврат;
	КонецЕсли;	
	
	Если Не Источник.Ссылка.Пустая() Тогда
		НовоеСостояние = Источник.Состояние;
		СтароеСостояние = ПолучитьСостояниеБизнесПроцесса(Источник);
		Если НовоеСостояние <> СтароеСостояние Тогда
			БизнесПроцессыИЗадачиСервер.ПриИзмененииСостоянияБизнесПроцесса(Источник, СтароеСостояние, НовоеСостояние);
		КонецЕсли;
	КонецЕсли;	
	
КонецПроцедуры

Функция ПолучитьСостояниеБизнесПроцесса(БизнесПроцесс)
	
	ОбщегоНазначения.ПолучитьЗначениеРеквизита(БизнесПроцесс.Ссылка, "Состояние");
	
КонецФункции	
