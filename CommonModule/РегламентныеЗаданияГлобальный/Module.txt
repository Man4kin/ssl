////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ ОБРАБОТКИ СИСТЕМНЫХ СОБЫТИЙ

// Процедура УведомлятьОНекорректномВыполненииРегламентныхЗаданий уведомляет
// пользователей о невыполнении регламентных заданий и "зависании" фоновых заданий.
//  Процедура работает только если информационная база файловая. Для серверной ИБ
// ответственность за выполнение регламентных заданий лежит на администраторе сервера 1С.
//  Подключает в процедуре РегламентныеЗаданияКлиент.ПриНачалеРаботыСистемы().
//
Процедура УведомлятьОНекорректномВыполненииРегламентныхЗаданий() Экспорт

	ПериодУведомления = Неопределено; // Минут.
	Если РегламентныеЗаданияСервер.НужноУведомлятьОНекорректномВыполненииРегламентныхЗаданий(ПериодУведомления) Тогда
		ОписаниеОшибки = "";
		ЗаданияВыполняютсяНормально = Неопределено;
		РегламентныеЗаданияСервер.ТекущийСеансВыполняетРегламентныеЗадания(ЗаданияВыполняютсяНормально, , ОписаниеОшибки);
		Если НЕ ЗаданияВыполняютсяНормально Тогда
			РегламентныеЗаданияКлиент.ПриОшибкеВыполненияРегламентныхЗаданий(ОписаниеОшибки);
		КонецЕсли;
		ПодключитьОбработчикОжидания("УведомлятьОНекорректномВыполненииРегламентныхЗаданий", ПериодУведомления * 60, Истина);
	КонецЕсли;

КонецПроцедуры

// Процедура ВыполнениеРегламентныхЗаданийВОсновномСеансе() вызывается
// обработчиком ожидания, который подключается в
// РегламентныеЗаданияКлиент.ПриНачалеРаботыСистемы().
//  Для выполнения в отдельном сеансе применяется форма
// Обработки.РегламентныеИФоновыеЗадания.Форма.ВыполнениеРегламентныхЗаданий.
//
Процедура ВыполнениеРегламентныхЗаданийВОсновномСеансе() Экспорт

	Если РегламентныеЗаданияСервер.ТекущийСеансВыполняетРегламентныеЗадания() Тогда
		РегламентныеЗаданияСервер.ВыполнитьРегламентныеЗадания();
		ПодключитьОбработчикОжидания("ВыполнениеРегламентныхЗаданийВОсновномСеансе", 60, Истина);
	КонецЕсли;
	
КонецПроцедуры

// Процедура предназначена для внутреннего использования
Процедура ЗапуститьОтдельныйСеансДляВыполненияРегламентныхЗаданийЧерезОбработчикОжидания() Экспорт
	
	Результат = РегламентныеЗаданияКлиент.ЗапуститьОтдельныйСеансДляВыполненияРегламентныхЗаданий();
	
	Если Результат.Отказ  Тогда
		Предупреждение(Результат.ОписаниеОшибки);
		
	ИначеЕсли Результат.ВыполненаПопыткаОткрытия Тогда
		
		ПодключитьОбработчикОжидания("АктивизироватьГлавноеОкноТекущегоСеансаПослеЗапускаОтдельногоСеансаВыполненияРегламентныхЗаданий", 2, Истина);
	КонецЕсли;
	
КонецПроцедуры

// Процедура предназначена для внутреннего использования
Процедура АктивизироватьГлавноеОкноТекущегоСеансаПослеЗапускаОтдельногоСеансаВыполненияРегламентныхЗаданий() Экспорт
	
	ОсновноеОкно = РегламентныеЗаданияКлиент.ОсновноеОкно();
	Если ОсновноеОкно <> Неопределено Тогда
		ОсновноеОкно.Активизировать();
	КонецЕсли;
	
КонецПроцедуры

