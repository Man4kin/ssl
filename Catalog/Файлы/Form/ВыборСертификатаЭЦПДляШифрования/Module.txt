&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	МассивСтруктурСертификатов = Параметры.МассивСтруктурСертификатов;
	
	Для Каждого СтруктураСертификата Из МассивСтруктурСертификатов Цикл
		НоваяСтрока = ТаблицаСертификатов.Добавить();
		
		НоваяСтрока.КомуВыдан = СтруктураСертификата.КомуВыдан;
		НоваяСтрока.КемВыдан = СтруктураСертификата.КемВыдан;
		НоваяСтрока.ДействителенДо = СтруктураСертификата.ДействителенДо;
		НоваяСтрока.Отпечаток = СтруктураСертификата.Отпечаток;
		
		Если СтруктураСертификата.Свойство("Пометка") Тогда
			НоваяСтрока.Пометка = СтруктураСертификата.Пометка;
		КонецЕсли;	
		
		НовоеНазначение = "";
		ОбщегоНазначения.ЗаполнитьНазначениеСертификата(СтруктураСертификата.Назначение, НовоеНазначение);
		НоваяСтрока.Назначение = НовоеНазначение;
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ТаблицаСертификатовВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	ОбработкаВыбора();
КонецПроцедуры

&НаКлиенте
Процедура Выбрать(Команда)
	ОбработкаВыбора();
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаВыбора()
	
	МассивВозврата = Новый Массив;
	Для Каждого СтрокаТаблицыЗначений Из ТаблицаСертификатов Цикл
		Если СтрокаТаблицыЗначений.Пометка Тогда 
			ВыбранныйСертификат = ЭлектронноЦифроваяПодписьКлиент.ПолучитьСертификатПоОтпечатку(СтрокаТаблицыЗначений.Отпечаток);
			МассивВозврата.Добавить(ВыбранныйСертификат);
		КонецЕсли;
	КонецЦикла;
	
	Если МассивВозврата.Количество() = 0 Тогда
		Предупреждение(НСтр("ru = 'Не выбран ни один сертификат.'"));
		Возврат;
	КонецЕсли;	
	
	Закрыть(МассивВозврата);
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьСертификат(Команда)
	
	ТекущиеДанные = Элементы.ТаблицаСертификатов.ТекущиеДанные;
	Если Не ТекущиеДанные = Неопределено Тогда 
		
		ВыбранныйСертификат = ЭлектронноЦифроваяПодписьКлиент.ПолучитьСертификатПоОтпечатку(ТекущиеДанные.Отпечаток);
		
		СтруктураСертификата = ЭлектронноЦифроваяПодписьКлиент.ЗаполнитьСтруктуруСертификата(ВыбранныйСертификат);
		Если СтруктураСертификата <> Неопределено Тогда
			ПараметрыФормы = Новый Структура("СтруктураСертификата, Отпечаток", СтруктураСертификата, ТекущиеДанные.Отпечаток);
			СтруктураВозврата = ОткрытьФормуМодально("Общаяформа.ФормаСертификатаЭЦП", ПараметрыФормы);
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры
