&НаКлиенте
Перем ЗначенияПеречисленияТипыВопросовШаблонаАнкеты;

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ МОДУЛЯ  

&НаСервере
Процедура СформироватьОтчет()
	
	РеквизитФормыВЗначение("Отчет").СформироватьОтчет(ТаблицаОтчета, Опрос,ВидОтчета);
	РеквизитыОпрос 		= ОбщегоНазначения.ПолучитьЗначенияРеквизитов(Опрос,"Наименование,Дата");
	НаименованиеОпроса 	= РеквизитыОпрос.Наименование;
	ДатаОпроса			= РеквизитыОпрос.Дата;
	
КонецПроцедуры // СформироватьОтчет()

// Процедура получает необходмые значения предопределенных значений,
// необходимых на клиенте.
&НаСервере                                                                                            
Процедура ПолучениеПредопределенныхЗначенийНеобходимыхНаКлиенте()
    	
	ПеречислениеТипыВопросовШаблонаАнкеты = Анкетирование.ПолучитьСтруктуруЗначенияПеречисления("ТипыВопросовШаблонаАнкеты",Истина);
	ПредопределеныеЗначенияНеобходимыеНаКлиенте.Вставить(0,ПеречислениеТипыВопросовШаблонаАнкеты);
                            
КонецПроцедуры // ПредопределеныеЗначенияНеобходимыеНаКлиенте() 

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ 

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ПолучениеПредопределенныхЗначенийНеобходимыхНаКлиенте();
	ВидОтчета = "Анализ ответов";
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ЗначенияПеречисленияТипыВопросовШаблонаАнкеты 	= ПредопределеныеЗначенияНеобходимыеНаКлиенте.Получить(0).Значение;
КонецПроцедуры   

////////////////////////////////////////////////////////////////////////////////
//КОМАНДЫ ФОРМЫ 

&НаКлиенте
Процедура Сформировать(Команда)
	
	Если Опрос.Пустая() Тогда
		Возврат;	
	КонецЕсли;
	
	СформироватьОтчет();
	ТаблицаОтчета.Показать();
	
КонецПроцедуры

//////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ 

&НаКлиенте
Процедура ТаблицаОтчетаОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Если Расшифровка.ТипВопроса = ЗначенияПеречисленияТипыВопросовШаблонаАнкеты.Табличный Тогда	
		ОткрытьФорму("Отчет.АнализОпроса.Форма.РасшифровкаТабличныхВопросов",Новый Структура("Опрос,ВопросШаблонаАнкеты,ПолныйКод,НаименованиеОпроса,ДатаОпроса",
																							Опрос,Расшифровка.ВопросШаблона,Расшифровка.ПолныйКод,НаименованиеОпроса,ДатаОпроса),ЭтаФорма);
	Иначе
		ОткрытьФорму("Отчет.АнализОпроса.Форма.РасшифровкаПростыхОтветов",Новый Структура("Опрос,ВопросШаблонаАнкеты,ВариантОтчета,ПолныйКод,НаименованиеОпроса,ДатаОпроса",
																							Опрос,Расшифровка.ВопросШаблона,"Респонденты",Расшифровка.ПолныйКод,НаименованиеОпроса,ДатаОпроса),ЭтаФорма);	
	КонецЕсли;
	
КонецПроцедуры  