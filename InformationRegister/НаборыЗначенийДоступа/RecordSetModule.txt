
// Обработчик события ПередЗаписью выполняет заполнение стандартных полей в наборе записей,
// содержащего сформированные наборы значений доступа в модуле объекта:
// - ресурсы Чтение,Добавление,Изменение,Удаление заполняются Истина, если все Ложь;
// - реквизиты устанавливаются по свойства видов доступа для повышения производительности
//   стандартных шаблонов ограничения доступа.
//
Процедура ПередЗаписью(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка ИЛИ ДополнительныеСвойства.Свойство("ВосстановлениеНаборовЗначенийДоступа") Тогда
		Возврат;
	КонецЕсли;
	
	// При обычной записи наборов значений доступа объекта,
	// в каждой записи заполняются
	// 1) ссылка на объект;
	// 2) реквизиты оптимизации производительности
	//    - ВидДоступаБезГруппЗначенияДоступа,
	//    - ВидДоступаЕдинственныйДляТипаЗначенияДоступа,
	//    - ВидДоступаЧерезПраваПоЗначениямДоступа;
	// и нормализуются ресурсы получения номеров наборов по правам доступа:
	//    Чтение, Добавление, Изменение, Удаление.
	Если      Отбор.Объект.Использование
	     И НЕ Отбор.НомерНабора.Использование
	     И НЕ Отбор.ВидДоступа.Использование
	     И НЕ Отбор.ЗначениеДоступа.Использование Тогда
		
		Если НЕ ДополнительныеСвойства.Свойство("НаборыЗначенийДоступаПодготовлены") Тогда
			УправлениеДоступом.ПодготовкаНаборовЗначенийДоступаПередЗаписью(Отбор.Объект.Значение, ЭтотОбъект);
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры // ПередЗаписью()

