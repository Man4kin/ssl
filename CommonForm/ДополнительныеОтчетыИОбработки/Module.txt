&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Пропускаем инициализацию, чтобы гарантировать получение формы при передаче параметра "АвтоТест".
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	ИмяРаздела = Параметры.ИмяРаздела;
	
	ВидОбработокСтрока = Параметры.Вид;
	
	Если	  ВидОбработокСтрока = ДополнительныеОтчетыИОбработкиКлиентСервер.ВидОбработкиЗаполнениеОбъекта() Тогда
		Заголовок = НСтр("ru = 'Команды заполнения объектов'");
	ИначеЕсли ВидОбработокСтрока = ДополнительныеОтчетыИОбработкиКлиентСервер.ВидОбработкиОтчет() Тогда
		Заголовок = НСтр("ru = 'Отчеты'");
	ИначеЕсли ВидОбработокСтрока = ДополнительныеОтчетыИОбработкиКлиентСервер.ВидОбработкиПечатнаяФорма() Тогда
		Заголовок = НСтр("ru = 'Дополнительные печатные формы'");
	ИначеЕсли ВидОбработокСтрока = ДополнительныеОтчетыИОбработкиКлиентСервер.ВидОбработкиСозданиеСвязанныхОбъектов() Тогда
		Заголовок = НСтр("ru = 'Команды создания связанных объектов'");
	ИначеЕсли ВидОбработокСтрока = ДополнительныеОтчетыИОбработкиКлиентСервер.ВидОбработкиДополнительнаяОбработка() Тогда
		Заголовок = НСтр("ru = 'Дополнительные обработки ('") + ДополнительныеОтчетыИОбработки.ПолучитьИмяРабочегоМеста(ИмяРаздела) + ")";
	ИначеЕсли ВидОбработокСтрока = ДополнительныеОтчетыИОбработкиКлиентСервер.ВидОбработкиДополнительныйОтчет()Тогда
		Заголовок = НСтр("ru = 'Дополнительные отчеты ('") + ДополнительныеОтчетыИОбработки.ПолучитьИмяРабочегоМеста(ИмяРаздела) + ")";
	КонецЕсли;
	
	ВидОбработок = ДополнительныеОтчетыИОбработки.ПолучитьВидОбработкиПоСтроковомуПредставлениюВида(ВидОбработокСтрока);
	
	Если ВидОбработок = Перечисления.ВидыДополнительныхОтчетовИОбработок.ДополнительныйОтчет
	 ИЛИ ВидОбработок = Перечисления.ВидыДополнительныхОтчетовИОбработок.Отчет Тогда
		Элементы.НастроитьСписокБыстрогоДоступа.Заголовок = НСтр("ru = 'Настроить список моих отчетов'");
	Иначе
		Элементы.НастроитьСписокБыстрогоДоступа.Заголовок = НСтр("ru = 'Настроить список моих обработок'");
	КонецЕсли;
	
	ЭтоГлобальныеОбработки = ДополнительныеОтчетыИОбработки.ПроверитьГлобальнаяОбработка(ВидОбработок);
	
	ЭтоНазначаемыеОбработки = ДополнительныеОтчетыИОбработки.ПроверитьНазначаемаяОбработка(ВидОбработок);
	
	Если ЭтоНазначаемыеОбработки Тогда
		
		Элементы.НастроитьСписокБыстрогоДоступа.Видимость = Ложь;
		
		ОбъектыНазначения.ЗагрузитьЗначения(Параметры.ОбъектыНазначения.ВыгрузитьЗначения());
		ОбНазначенияСсылка = ОбъектыНазначения.Получить(0).Значение;
		МетаданныеОбНазначения = ОбъектыНазначения.Получить(0).Значение.Метаданные();
		
		ПолноеИмяОбъектаМетаданных = МетаданныеОбНазначения.ПолноеИмя();
		
		ЭтоФормаОбъекта = ДополнительныеОтчетыИОбработки.ЭтоФормаОбъекта(ПолноеИмяОбъектаМетаданных, Параметры.ИмяФормы);
		
	КонецЕсли;
	
	ЗаполнитьТаблицуОбработок();
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкиВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ВыполнитьОбработкуПоПараметрам();
	
КонецПроцедуры

&НаКлиенте
Процедура ВыполнитьОбработку(Команда)
	
	ВыполнитьОбработкуПоПараметрам()
	
КонецПроцедуры

&НаКлиенте
Процедура ВыполнитьОбработкуПоПараметрам()
	
	ТекущиеДанные = Элементы.Обработки.ТекущиеДанные;
	
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ЭтоГлобальныеОбработки Тогда
		ОбъектыНазначенияМассив = Неопределено;
	Иначе
		ОбъектыНазначенияМассив = ОбъектыНазначения.ВыгрузитьЗначения();
	КонецЕсли;
	
	ДополнительныеОтчетыИОбработкиКлиент.ВыполнитьОбработку(
					ТекущиеДанные.Ссылка,
					ВидОбработокСтрока,
					ТекущиеДанные.Идентификатор,
					ТекущиеДанные.БезопасныйРежим,
					ТекущиеДанные.ВариантЗапуска,
					ТекущиеДанные.ПоказыватьОповещение,
					ТекущиеДанные.Модификатор,
					ОбъектыНазначенияМассив);
	
	Закрыть();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьТаблицуОбработок()
	
	ДоступныеКоманды = ДополнительныеОтчетыИОбработки.ПолучитьДоступныеКоманды(
							ЭтоНазначаемыеОбработки,
							ПолноеИмяОбъектаМетаданных,
							ЭтоФормаОбъекта,
							ИмяРаздела,
							ВидОбработок);
	
	ЗначениеВРеквизитФормы(ДоступныеКоманды, "Обработки");
	
КонецПроцедуры

&НаКлиенте
Процедура Настроить(Команда)
	
	Результат = ОткрытьФормуМодально("ОбщаяФорма.НастройкаМоихОтчетовИОбработок",
		Новый Структура("ВидОбработок,ЭтоГлобальныеОбработки,ТекущийРаздел", 
						ВидОбработок,
						ЭтоГлобальныеОбработки,
						ИмяРаздела
						) );
	
	Если ТипЗнч(Результат) = Тип("Булево") Тогда
		ЗаполнитьТаблицуОбработок();
	КонецЕсли;
	
КонецПроцедуры
